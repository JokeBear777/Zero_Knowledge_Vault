<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Dynamic Password</title>
</head>
<body>

<h1>Dynamic Password</h1>

<p>안전한 원격 데이터 저장소 서비스 입니다.</p>

<div id="content">
    <p>상태 확인 중...</p>
</div>

<script>
    window.onload = init;

    async function init() {

        const content = document.getElementById("content");

        try {
            const res = await fetch("/api/member/me", {
                credentials: "include"
            });

            if (!res.ok) {
                showLogin(content);
                return;
            }

            const data = await res.json();

            if (data.pakeAuthStatus === "NOT_REGISTERED") {
                window.location.href = "/setup-mp.html";
                return;
            }

            if (data.pakeAuthStatus === "DISABLED") {
                window.location.href = "/account-disabled.html";
                return;
            }

            if (data.pakeAuthStatus === "ROTATING") {
                window.location.href = "/rotate-mp.html";
                return;
            }

            if (data.authLevel === "PRE_AUTH") {
                window.location.href = "/unlock.html";
                return;
            }

            window.location.href = "/dashboard.html";

        } catch (e) {
            showLogin(content);
        }
    }

    function showLogin(content) {
        content.innerHTML = `
        <p>로그인이 필요합니다.</p>
        <button onclick="goLogin()">네이버 로그인</button>
    `;
    }

    function goLogin() {
        window.location.href = "/oauth2/authorization/naver";
    }
</script>

</body>
</html>